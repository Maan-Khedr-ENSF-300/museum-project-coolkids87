import mysql.connector
from mysql.connector import errorcode
import os



# q: can you handle documentation for this function? like the promises it makes and what it does?
# a: sure 
def attribute_display(input_table, cur):
    """
    Input: 
        The table that the user wants to view the attributes 
        The cursor object.

    Output:
      Displays all the attributes of that table.

    Features:
      Displays all the attributes that the user can view from the table.
      If the user inputs an attribute that does not belong to the table, the program will ask the user to input an attribute that does belong to the table.
    """
    instr = ("select * from", input_table)
    cur.execute(instr)
    print("The attributes that you can view from this table are:\n")
    for i in range(len(cur.column_names)):  
        print((cur.column_names)[i]," ")                    # displays every column/attribute in the table the user inputted
    print("Please input below the attributes you would like to view from this table:\n")
    input3 = input()
    if input3 not in cur.column_names:
        print("Please input attributes that belong to the table like the one's listed above:\n")
        attribute_display(input_table)
    for i in input3:
        cur.execute("select", i, "from", input_table)
        print("Here are all the records for that attribute(s) you wanted to view:\n")
        all_recs = cur.fetchall()
        num_rows = len(all_recs)
        for i in num_rows:                      
            print("Record",i, all_recs[i], end = '\n')              # prints every record for column(s) that user requested.
    return


def row_display(input_table,cur):
    """
    Input:
        The table that the user wants to view the rows
        The cursor object.
    
    Output:
        Displays all the rows of that table.

    Features:
        Asks the user how many rows they would like to view.
        Prompts the amount of rows the user can view.
        If the user inputs a number that is greater than the number of rows in the table, 
            the program will ask the user to input a number that is less than or equal to the number of rows in the table.
        If the user inputs a number that is less than the number of rows in the table,
            the program will ask the user to input the row numbers that they would like to view. (inputing 0 is an option to not view any rows)
    """
    row_count = 0
    cur.execute("select * from",input_table)
    whole = cur.fetchall()
    for row in whole:
        row_count += 1
    print("There are", row_count, "rows in this table\n")
    print("How many rows would you like to display? \n")
    row_input1 = int(input())
    
    if row_input1 > row_count:
        print("Sorry, but thats an invalid input as not that many rows exist in that table\n")
        print("Please enter the number of rows you would like displayed:\n")
        row_input2 = int(input())
        if row_input2 > row_count:
            print("invalid input")
            exit()

    if row_input1 == row_count:
        size  = len(whole)
        for i in range(size):
            for x in range(len(whole[i])):
                print(f'{whole[i][x]: <20}')
            print()

    if row_input1 < row_count:
        print("Which rows specifically would you like to see?\n")
        print("Please input the row numbers starting from 1 up to the max row number seperated by whitespace of which you would like to see\n")
        row_input3 = input()
        empty_list = []
        for i in row_input3:
            empty_list.append(i)
        for i in empty_list:
            if i > row_count:
                print("At least one invalid input is present\n")
                exit()
        if len(empty_list) > row_count:
            print("You entered more rows than is present in the table\n")
            exit()
        if row_input3 == None or ' ':
            print("You dont want to see any rows\n")
            return
        for i in empty_list:
            cur.execute("select row_number(empty_list[i]) over(len(empty_list)) as num_row FROM", input_table)
            print(cur.fetchall(), end = '\n')
    return


def value_display(input_table, cur):
    return


# Below function will handle printing/ querying entire tables for non-admin users.

def query(input_table, cur):
    if input_table == '' or None:
        table_selection = input("Which table would you like to query? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
        while (table_selection != "ARTIST" and table_selection != "EXHIBITION" and table_selection != "ART_OBJECT" and table_selection != "PERMANENT_COLLECTION" and table_selection != "OTHER_COLLECTION" and table_selection != "BORROWED_COLLECTION" and table_selection != "OTHER" and table_selection != "PAINTING" and table_selection != "STATUE"):
            print("Invalid selection\n")
            table_selection = input("Which table would you like to query? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
        input_table = table_selection
        cur.execute("select * from", input_table)
    print("Would you like to view the entire table (Y/N) ?:\n")
    user_input = input()
    if user_input == 'Y':
        cur.execute("select * from",input_table)
        rows = cur.fetchall()
        size  = len(rows)
        for i in range(size):
            for x in range(len(rows[i])):
                print(rows[i][x], end = '\t')
            print()

    elif user_input == 'N':
        print("Options:\n")
        print("1- Display Certain Attributes (columns)")
        print("2- Display Certain Rows of the Table")
        print("3- Display Certain Values of Table")
        user_input = int(input())
        if user_input == 1:
            attribute_display(input_table)
        elif user_input == 2:
            row_display(input_table)
        elif user_input == 3:
            value_display(input_table)

    #Left off here 
    # dope. maybe copy the code and paste into github, if not I can.
    # I'll do that now
    # attribute_selection = input("Which attribute would you like to query? (Enter the attribute name or * to select all attributes):\n")
    
    # while(attribute_selection not in cur.column_names and attribute_selection != "*"):
    #    print("Invalid selection\n")
    #     attribute_selection = input("Which attribute would you like to query? (Enter the attribute name or * to select all attributes):\n")
    # if attribute_selection == "*":
    #     print(cur.fetchall())
    # else:
    #     cur.execute("select", attribute_selection, "from", table_selection)


def admin_consol(cur, cnx):
    print('Select an option:\n1 - Perform a query\n2 - Provide the path and file name of an sql script file to the application, which will then run the script file on MySQL using the connector\n3 - exit')
    user_input = int(input())
    if user_input not in [1, 2, 3]:
        print("Invalid input\n")
        user_input = int(input())
    
    if user_input == 1:
        command = input("Type your SQL command here:\n")
        if ('INSERT' in command) or ('UPDATE' in command) or ('DELETE' in command):
            cur.execute(command)
            cnx.commit()
        else:
            cur.execute(command)
            rows = cur.fetchall()
            size  = len(rows)
            for i in range(size):
                for x in range(len(rows[i])):
                    print(f'{rows[i][x]: <20}')
                print()
      
    if user_input == 2:                                         # connects the admin to the .sql script of their choice.
        print("Please provide the file pathway below:\n")
        path_input = input()
        if os.path.exists(path_input) == 1:                     # Boolean verification to ensure the file pathway inputted by the user exists.
            cur.execute("source",path_input)
        else:
            print("Please print a file pathway that exists on your computer:\n")
            path_input = input()
            cur.execute("source",path_input)

    if user_input == 3:                                    # lets the user exit the application.
        print("goodbye\n")
        exit()
        


        
def data_entry(cur, cnx):
    menu = "What would you like to do:\n1 - Perform a query\n2 - Insert new tuples to a table using a file\n3 - Insert a tuple to a table using prompts\n4 - Update a tuple\n5 - Delete a tuple\n6 - Exit"
    selection = int(input(menu))
    while (selection > 6 or selection < 1):
        print("Invalid selection\n")
        selection = int(input(menu))
    if selection == 1:
        query(None)
    elif selection == 2:
        insert_tuple_file(cur, cnx)   
    elif selection == 3:
        insert_tuple_prompt(cur)
    elif selection == 4:
        update_tuple(cur)
    elif selection == 5:    
        delete_tuple(cur, cnx)
    elif selection == 6:
        return
    
def insert_tuple_file(cur, cnx):
    table_selection = input("Which table would you like to insert a tuple into? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
    while (table_selection != "ARTIST" and table_selection != "EXHIBITION" and table_selection != "ART_OBJECT" and table_selection != "PERMANENT_COLLECTION" and table_selection != "OTHER_COLLECTION" and table_selection != "BORROWED_COLLECTION" and table_selection != "OTHER" and table_selection != "PAINTING" and table_selection != "STATUE"):
        print("Invalid selection\n")
        table_selection = input("Which table would you like to insert a tuple into? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
    
    filename = input("Please enter the name of the file you would like to open(each line of text in the file should be attribute values corresponding to the order in the table, separated by commas):\n")
    insert_file = open(filename, "r")
    for line in insert_file.readlines():
        cur.execute("insert into", table_selection, "values", line)
        cnx.commit()
    insert_file.close()


def insert_tuple_prompt(cur):
    table_selection = input("Which table would you like to insert a tuple into? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
    while (table_selection != "ARTIST" and table_selection != "EXHIBITION" and table_selection != "ART_OBJECT" and table_selection != "PERMANENT_COLLECTION" and table_selection != "OTHER_COLLECTION" and table_selection != "BORROWED_COLLECTION" and table_selection != "OTHER" and table_selection != "PAINTING" and table_selection != "STATUE"):
        print("Invalid selection\n")
        table_selection = input("Which table would you like to insert a tuple into? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
    cur.execute("select * from", table_selection)
    
    attribute_list = []
    for col_name in cur.column_names:
        attribute_selection = input("Enter the value for " + col_name + ":\n")
        attribute_list.append(attribute_selection)
    
    cur.execute("insert into", table_selection, "values", attribute_list)

    cur.commit()

    

def update_tuple(cur, cnx):
    print("Which table would you like to update? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
    table_selection = input()
    while (table_selection != "ARTIST" and table_selection != "EXHIBITION" and table_selection != "ART_OBJECT" and table_selection != "PERMANENT_COLLECTION" and table_selection != "OTHER_COLLECTION" and table_selection != "BORROWED_COLLECTION" and table_selection != "OTHER" and table_selection != "PAINTING" and table_selection != "STATUE"):
        print("Invalid selection\n")
        table_selection = input("Which table would you like to update? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
    
    print("Which attribute would you like to update? (Enter the attribute name):\n")
    update_attribute_selection = input()
    cur.execute("select * from", table_selection)
    while (update_attribute_selection not in cur.column_names):
        print("Invalid selection\n")
        update_attribute_selection = input("Which attribute would you like to update? (Enter the attribute name):\n")
    
    update_value_selection = input("What would you like to update the value to?\n")
    
    condition_attribute_selection = input("Which attribute would you like to use as a condition? (Press enter to have no condition[updates every {} value in {} to {}]):\n".format(update_attribute_selection, table_selection, update_value_selection))
    while (condition_attribute_selection not in cur.column_names and condition_attribute_selection != ""):
        print("Invalid selection\n")
        condition_attribute_selection = input("Which attribute would you like to use as a condition? (Press enter to have no condition[updates every {} value in {} to {}]):\n".format(update_attribute_selection, table_selection, update_value_selection))
    
    if condition_attribute_selection == "":
        cur.execute("update", table_selection, "set", update_attribute_selection, "=", update_value_selection)
    
    else:
        condition_value_selection = input("What would you like the condition value to be?\n")
        cur.execute("update", table_selection, "set", update_attribute_selection, "=", update_value_selection, "where", condition_attribute_selection, "=", condition_value_selection)
    
    cnx.commit()
    if cur.rowcount == 0:
        print("No tuples were updated")
    else:
        print("Updated {} tuples".format(cur.rowcount)) 

def delete_tuple(cur, cnx):
    print('Which table would you like to delete a tuple from? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n')
    table_selection = input()
    while (table_selection != "ARTIST" and table_selection != "EXHIBITION" and table_selection != "ART_OBJECT" and table_selection != "PERMANENT_COLLECTION" and table_selection != "OTHER_COLLECTION" and table_selection != "BORROWED_COLLECTION" and table_selection != "OTHER" and table_selection != "PAINTING" and table_selection != "STATUE"):
        print("Invalid selection\n")
        table_selection = input("Which table would you like to query? (ARTIST, EXHIBITION, ART_OBJECT, PERMANENT_COLLECTION, OTHER_COLLECTION, BORROWED_COLLECTION, OTHER, PAINTING, STATUE):\n")
   
    print('Which attribute would you like to use to delete a tuple? (or press enter to delete all contents of table):\n')
    attribute_selection = input()
    cur.execute("select * from", table_selection)
    while (attribute_selection not in cur.column_names and attribute_selection != ""):
        print("Invalid selection\n")
        attribute_selection = input("Which attribute would you like to use to delete a tuple? (or press enter to delete all contents of table):\n")
    
    if attribute_selection == "":
        cur.execute("delete from", table_selection)
    
    else:
        print('Enter a value condition to use to delete a tuple(s):\n')
        value_selection = input()
        cur.execute("delete from", table_selection, "where", attribute_selection, "=", value_selection)
    
    cnx.commit()
    if(cur.rowcount == 0):
        print("No tuples were deleted\n")
    else:
        print(cur.rowcount, "record(s) deleted")

def guest_view():
    print("What are you looking for:\n")
    print("1- Artist Information\n")
    print("2- Exhibit Information\n")
    print("3- Art Object information\n")
    print("4- Permanent collection of Art Objects\n")
    print("5- Borrowed Collection of Art Objects\n")
    print("6- Other Collection of Art Objects\n")
    print("7- Painting Information\n")
    print("8- Statue Information\n")
    print("9- Other Types of Art\n")
    print("Please input a number corresponding to a table that you would like to view:\n")
    # From here, depending on what the user inputs they will then be prompted if they want to see a specific
    # attribute from the table or if they want to execute a particular join to merely see attributes belonging to two seperate tables.
    table = ''
    selection = int(input())
    if selection not in range(1, 10):
        guest_view()
    else:
        if selection == 1:
            table = 'ARTIST'
        elif selection == 2:
            table = 'EXHIBITION'
        elif selection == 3:
            table = 'ART_OBJECT'
        elif selection == 4:
            table = 'PERMANENT_COLLECTION'
        elif selection == 5:
            table = 'OTHER_COLLECTION'
        elif selection == 6:
            table = 'BORROWED_COLLECTION'
        elif selection == 7:
            table = 'PAINTING'
        elif selection == 8:
            table = 'STATUE'
        elif selection == 9:
            table = 'OTHER'
        
    if table != '' or table != None:
        query(table)
        
def main():   
    # Connect to server
    print("Welcome to the Arts Museum Database:")
    print("In order to proceed please select your role from the list below:\n")
    print("1-DB Admin")
    print("2-Data Entry")
    print("3-Browse as guest")

    selection = int(input())
    while selection not in [1,2,3]:
        print("Invalid selection")
        selection = int(input())

    if selection in [1,2]:
        username= input("user name:")
        passcode= input("password:")
    else:
        username="guest"   
        passcode=None
    
    try:
        cnx = mysql.connector.connect(
            host="127.0.0.1",
            port=33060,
            user=username,
            password=passcode)  
        
    
    except mysql.connector.Error as err:
        if err.errno == errorcode.ER_ACCESS_DENIED_ERROR:
            print("Issue with username or password")
        elif err.errno == errorcode.ER_BAD_DB_ERROR:
            print("Database does not exist")
        else:
            print(err)

    cur = cnx.cursor()  
            
    fd = open("db_name", "r")
    sqlfile = fd.read()
    fd.close()
    sqlcommands = sqlfile.split(';')
    for command in sqlcommands:
        try:
            if command.strip() != '':
                cur.execute(command)
        except(IOError):
            print("command skipped")
        
    # Get a cursor
  
    
    # Execute a query
    cur.execute("use Art_museum")
    if selection == 1:
        admin_consol(cur, cnx)
    elif selection == 2:
        data_entry(cur, cnx)
    else:
        guest_view()

     # Close connection
    cnx.close()

if __name__ == "__main__":
    main()


